//! Direct Sequence Spread (DSS) â€” XOR-based spectral spreading.

/// 64-byte magic table used to XOR payload data for more uniform spectral energy.
#[rustfmt::skip]
const DSS_MAGIC: [u8; 64] = [
    0x96, 0x9f, 0xb4, 0xaf, 0x1b, 0x91, 0xde, 0xc5,
    0x45, 0x75, 0xe8, 0x2e, 0x0f, 0x32, 0x4a, 0x5f,
    0xb4, 0x56, 0x95, 0xcb, 0x7f, 0x6a, 0x54, 0x6a,
    0x48, 0xf2, 0x0b, 0x7b, 0xcd, 0xfb, 0x93, 0x6d,
    0x3c, 0x77, 0x5e, 0xc3, 0x33, 0x47, 0xc0, 0xf1,
    0x71, 0x32, 0x33, 0x27, 0x35, 0x68, 0x47, 0x1f,
    0x4e, 0xac, 0x23, 0x42, 0x5f, 0x00, 0x37, 0xa4,
    0x50, 0x6d, 0x48, 0x24, 0x91, 0x7c, 0xa1, 0x4e,
];

/// Get magic byte at index (wraps around at 64).
#[inline]
pub fn get_dss_magic(i: usize) -> u8 {
    DSS_MAGIC[i % 64]
}

/// Apply DSS: XOR each byte with the magic table.
pub fn apply_dss(data: &mut [u8]) {
    for (i, b) in data.iter_mut().enumerate() {
        *b ^= get_dss_magic(i);
    }
}

/// Reverse DSS: identical to apply (XOR is its own inverse).
pub fn reverse_dss(data: &mut [u8]) {
    apply_dss(data);
}
